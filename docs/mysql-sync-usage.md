# MySQL 同步功能使用指南

## 功能概述

MySQL 同步功能允许你将待办事项数据同步到 MySQL 数据库中，实现多设备间的数据共享和备份。

## 前置条件

1. **MySQL 数据库服务器**
   - 版本：MySQL 5.7 或更高版本
   - 网络：确保应用可以访问数据库服务器
   - 权限：用户需要有创建表和读写数据的权限

2. **数据库准备**
   - 创建一个专用的数据库（如：`todo_sync`）
   - 确保数据库用户有足够的权限

## 配置步骤

### 1. 打开数据库配置界面

1. 启动 Tauri Todo 应用
2. 在设置中找到"数据库同步"选项
3. 点击打开数据库配置对话框

### 2. 填写连接信息

在配置界面中填写以下信息：

| 字段 | 说明 | 默认值 | 示例 |
|------|------|--------|------|
| 主机地址 | 数据库服务器地址 | localhost | 192.168.1.100 |
| 端口 | 数据库端口 | 3306 | 3306 |
| 用户名 | 数据库用户名 | root | todo_user |
| 密码 | 数据库密码 | - | your_password |
| 数据库名 | 目标数据库名称 | todo_sync | todo_sync |

### 3. 测试连接

1. 填写完连接信息后，点击"测试连接"按钮
2. 如果连接成功，会显示绿色的成功提示
3. 如果连接失败，会显示具体的错误信息

### 4. 开启同步

1. 连接测试成功后，点击"开启同步"按钮
2. 系统会提示确认同步操作
3. 确认后，系统会自动：
   - 检查数据库表结构
   - 创建必要的表（如果不存在）
   - 比较本地和远程数据
   - 执行数据同步

## 同步机制

### 自动同步

启用同步后，以下操作会自动触发同步：

1. **待办事项变更**
   - 添加新的待办事项
   - 修改待办事项内容
   - 标记完成/未完成
   - 删除待办事项
   - 设置截止时间

2. **设置变更**
   - 修改颜色设置
   - 调整归档天数
   - 其他应用设置

### 同步策略

系统使用智能同步策略：

1. **时间戳比较**
   - 比较本地和远程数据的最后更新时间
   - 较新的数据会覆盖较旧的数据

2. **双向同步**
   - 本地较新：上传本地数据到远程
   - 远程较新：从远程下载数据到本地
   - 时间相同：跳过同步

3. **防抖机制**
   - 待办事项变更后等待 2 秒再同步
   - 避免频繁的同步操作

## 数据表结构

### 设置同步表 (todo_settings_sync)

存储应用设置和同步元数据：

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INT | 主键，自增 |
| update_time | VARCHAR(50) | 更新时间 |
| field_name | VARCHAR(100) | 字段名 |
| data_type | VARCHAR(50) | 数据类型 |
| field_value | TEXT | 字段值 |
| last_update | VARCHAR(50) | 最后更新时间 |

### 待办同步表 (todo_items_sync)

存储待办事项数据：

| 字段 | 类型 | 说明 |
|------|------|------|
| id | VARCHAR(50) | 待办事项ID |
| parent_id | VARCHAR(50) | 父项ID（支持树形结构） |
| text | TEXT | 待办事项内容 |
| completed | BOOLEAN | 是否完成 |
| created_at | VARCHAR(50) | 创建时间 |
| completed_at | VARCHAR(50) | 完成时间 |
| deadline | VARCHAR(50) | 截止时间 |
| last_update | VARCHAR(50) | 最后更新时间 |

## 常见问题

### Q: 连接测试失败怎么办？

A: 请检查以下项目：
1. 数据库服务器是否正在运行
2. 网络连接是否正常
3. 用户名和密码是否正确
4. 数据库是否存在
5. 用户是否有足够的权限

### Q: 同步失败怎么办？

A: 可能的原因：
1. 网络连接不稳定
2. 数据库服务器繁忙
3. 数据格式不兼容
4. 权限不足

建议：
1. 检查网络连接
2. 稍后重试
3. 检查数据库日志

### Q: 如何禁用自动同步？

A: 在同步设置中可以：
1. 关闭自动同步功能
2. 调整防抖时间
3. 手动控制同步时机

### Q: 数据冲突怎么处理？

A: 系统使用时间戳比较：
1. 较新的数据会覆盖较旧的数据
2. 如果时间相同，会跳过同步
3. 建议定期同步以避免数据差异过大

## 安全注意事项

1. **密码安全**
   - 使用强密码
   - 定期更换密码
   - 不要在公共场所输入密码

2. **网络安全**
   - 使用安全的网络连接
   - 考虑使用 VPN 或加密连接
   - 避免在公共 Wi-Fi 上同步

3. **数据备份**
   - 定期备份数据库
   - 保留本地数据副本
   - 测试恢复流程

## 技术支持

如果遇到问题，请：

1. 检查应用日志
2. 查看数据库错误日志
3. 确认网络连接状态
4. 验证数据库配置

更多技术细节请参考：[MySQL 同步功能实现总结](./mysql-sync-implementation.md)

